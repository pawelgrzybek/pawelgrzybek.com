---
title: "Quick script to convert JPEG/PNG images to WebP and AVIF"
summary: "Browser support for modern image formats like WebP and AVIF is excellent, so you should use them to take advantage of their bandwidth savings."
---

Browser support for modern image formats like WebP and AVIF is excellent, so you should use them to take advantage of their bandwidth savings. By taking a little care and preparing these image formats for my articles, I am saving you around 60% of the data compared to JPEG equivalents. You are welcome!

Modern frameworks often come equipped with the tooling that can handle format conversion for you. A plugin for your favourite tool may already exist if they are not built-in. [Next.js `<Image>` component](https://nextjs.org/docs/pages/api-reference/components/image) and [Gatsby Image plugin](https://www.gatsbyjs.com/docs/reference/built-in-components/gatsby-plugin-image/) come built-in. The [@sveltejs/enhanced-img](https://kit.svelte.dev/docs/images#sveltejs-enhanced-img) for Svelte fans and [@11ty/eleventy-img](https://www.11ty.dev/docs/plugins/image/) for Eleventy users are just one `npm install` away.

[Hugo](https://gohugo.io), which I use to build this website, supports WebP but cannot generate AVIF images. Because of this limitation of [the Hugo Fit method](https://gohugo.io/methods/resource/fit/), I do the image conversion myself using a simple script I wanted to share with you today. It is a [fish-shell](https://fishshell.com) script, but it should be simple to replicate it in bash or zsh. It relies on three external dependencies: [webp](https://developers.google.com/speed/webp), [avif](https://github.com/lovell/avif-cli) and [imageoptim-cli](https://github.com/JamieMason/ImageOptim-CLI).

```fish
function optim
  for file in $argv
    set filePath (realpath $file)
    set filePathNoExtension (string split -r -m 1 . -- $filePath)[1]
    set filePathWebp $filePathNoExtension.webp

    cwebp -quiet $filePath -o $filePathWebp
    avif --input="$filePath"
    imageoptim --no-stats $filePath
  end
end
```

My GitHub has [a more advanced version](https://github.com/pawelgrzybek/dotfiles/blob/master/fish/functions/optim.fish) with fancy logging and safety nets. Here is an example of how you invoke it. I am also attaching a picture generated by the script above with a detailed description of size differences between different formats. I hope you found it helpful!

```
optim one.jpg two.jpg three.png
```

{{< figure
  src="view.jpg"
  alt="A pretty cool view from one of the Greek islands"
  caption="JPEG: 196kb, WebP: 88kb, AVIF: 61kb"
>}}
